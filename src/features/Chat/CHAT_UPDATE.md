# Обновление функциональности чата

## Изменения

### 1. Добавлено API для получения пользователей чата

**Файл**: `src/features/Chat/model/services/chatAPI.ts`

- Добавлена функция `getChatUsers()` для получения списка пользователей из endpoint `users/chat-users/`

### 2. Добавлены новые типы

**Файл**: `src/features/Chat/model/types/chat.ts`

- Добавлен интерфейс `ChatUser` для представления пользователя чата с полными данными профиля

### 3. Созданы новые компоненты для выбора пользователей

#### UserAsyncSelect

**Файл**: `src/features/Chat/ui/UserAsyncSelect.tsx`

- Компонент для выбора одного пользователя (приватная беседа)
- Загружает список пользователей асинхронно
- Отображает аватар, имя и фамилию пользователя
- Поддерживает поиск по имени

#### UserAsyncMultiSelect

**Файл**: `src/features/Chat/ui/UserAsyncMultiSelect.tsx`

- Компонент для выбора нескольких пользователей (групповая беседа)
- Загружает список пользователей асинхронно
- Отображает выбранных пользователей в виде badges с аватарами
- Поддерживает добавление и удаление участников
- Поддерживает поиск по имени

### 4. Обновлен компонент ChatSelect

**Файл**: `src/features/Chat/ui/ChatSelect.tsx`

Изменения:
- Добавлен выбор участников при создании беседы:
  - Для приватной беседы: `UserAsyncSelect` (выбор одного пользователя)
  - Для групповой беседы: `UserAsyncMultiSelect` (выбор нескольких пользователей)
- Добавлена функциональность удаления беседы:
  - Кнопка удаления появляется при наведении на беседу
  - Подтверждение удаления через `UseConfirmationDialog`
  - Индикатор загрузки во время удаления
- Участники автоматически добавляются при создании беседы

### 5. Обновлен контейнер чата

**Файл**: `src/features/Chat/ui/ChatContainer.tsx`

- Добавлена функция `handleDeleteConversation()` для удаления бесед
- Обновлен список бесед после удаления
- Автоматическое переключение чата при удалении текущей беседы

## API Endpoint

### GET users/chat-users/

Возвращает список пользователей для чата:

```json
[
  {
    "id": 0,
    "first_name": "string",
    "last_name": "string",
    "middle_name": "string",
    "avatar": "string",
    "role": "admin_org",
    "position": "string",
    "email": "user@example.com",
    "bio": "string",
    "number_phone": "string",
    "telegram_username": "string",
    "group": "string"
  }
]
```

## Использование

### Создание приватной беседы

1. Нажмите кнопку "+" в списке чатов
2. Выберите тип "Приватная"
3. Выберите пользователя из выпадающего списка
4. Нажмите "Создать"

### Создание групповой беседы

1. Нажмите кнопку "+" в списке чатов
2. Выберите тип "Групповая"
3. Введите название беседы
4. Выберите участников из выпадающего списка
5. Нажмите "Создать"

### Удаление беседы

1. Наведите курсор на беседу в списке
2. Нажмите на иконку корзины справа
3. Подтвердите удаление в диалоговом окне

## Особенности

- Все выбранные пользователи автоматически добавляются как участники при создании беседы
- Компоненты выбора пользователей загружают данные асинхронно только при открытии
- Поддержка поиска пользователей по имени и фамилии
- Валидация: нельзя создать групповую беседу без названия и участников
- Валидация: нельзя создать приватную беседу без выбора пользователя
- UI удаления чата появляется только при наведении для предотвращения случайных удалений


